new TotalHouses = 0;

#define PICKUP_NEWHOUSE 19524 //Yellow House Icon
#define PICKUP_HOUSWOWNED 1273 //Green House Icon

/*
    forward
*/
forward LoadHouses();
forward OnCreateHouse(playerid, houseID, price, Float:HX, Float:HY, Float:HZ);
forward OnDeleteHouse(playerid, houseID);
forward OnDeleteAllHouses(playerid);
forward OnUpdateHouseExterior(playerid, HouseID, Float:HX, Float:HY, Float:HZ, Interior);
forward OnUpdateHouseInterior(playerid, HouseID, Float:HX, Float:HY, Float:HZ, Interior);
forward OnUpdateHouseDesc(playerid, HouseID, desc[]);
forward OnUpdateHouseOwner(playerid, HouseID, owner[]);
forward OnUpdateHousePrice(playerid, HouseID, price);
forward OnHouseLeft(playerid, HouseID);
forward OnHouseSold(playerid, targetid, HouseID, price);
forward SendPlayerInside(playerid, HouseID);
forward SendPlayerOutside(playerid, HouseID);

/*
    Enums
*/
enum hInfo
{
	houseSQLID,
	houseAddress[35],
	houseDesc[128],
	bool:houseOwned,
	houseOwner[MAX_PLAYER_NAME+1],
	bool:houseLocked,
    houseType,
	housePrice,
    houseInt[2],
    houseBuilder,
    houseBuilderTime,
    Float:houseExterior[3],
    Float:houseInterior[3],
	bool:houseCustInt,
 	bool:houseExists,
	STREAMER_TAG_MAP_ICON: houseMapIcon,
	STREAMER_TAG_PICKUP: housePickup,
	STREAMER_TAG_3D_TEXT_LABEL: house3DText,
};
enum houseStructure {
    structureID,
    structureModel,
    Float:structurePos[3],
    Float:structureRot[3],
    structureMaterial,
    structureColor,
    structureType,
    structureObject
};

enum e_HouseStructure {
    e_StructureName[32],
    e_StructureModel,
    e_StructureCost
};

new HouseData[MAX_HOUSES][hInfo];
new Iterator:House<MAX_HOUSES>;

new HouseStructure[MAX_HOUSES][MAX_HOUSE_STRUCTURES][houseStructure],
    IteratorArray:HouseStruct[MAX_HOUSES]<MAX_HOUSE_STRUCTURES>;

new ListedStructure[MAX_PLAYERS][MAX_HOUSE_STRUCTURES];
new SelectStructureType[MAX_PLAYERS];

new const g_aHouseStructure[][e_HouseStructure] = {
    {"Half wall", 19428, 25},
    {"Full wall", 19355, 50},
    {"Full wall with door", 19385, 40},
    {"Full wall with window", 19401, 40},
    {"Door", 1502, 20}
};

new EditingHouseStructure[MAX_PLAYERS];

enum houseInteriors {
    eHouseInterior,
    Float:eHouseX,
    Float:eHouseY,
    Float:eHouseZ,
    Float:eHouseAngle
};

new const Float:arrHouseInteriors[3][houseInteriors] = {
    {3, 387.78, 634.47, 1009.67, 91.58},
    {4, 431.00, 612.65, 1000.22, 89.33},
    {5, 1384.50, 1518.17, 10.95, 270.38}
};

enum e_HouseInteriors {
    e_ObjModel,
    Float:e_ObjPosX,
    Float:e_ObjPosY,
    Float:e_ObjPosZ,
    Float:e_ObjRotX,
    Float:e_ObjRotY,
    Float:e_ObjRotZ,
    e_Type
};

new const g_aHouseInteriors[][e_HouseInteriors] = {
    // Small
    {19379,383.881,632.481,1012.149,0.000,90.000,270.000,1},
    {19379,374.301,632.481,1012.149,0.000,90.000,270.000,1},
    {19379,374.301,622.131,1012.149,0.000,90.000,270.000,1},
    {19379,374.301,621.990,1008.589,0.000,90.000,270.000,1},
    {19379,374.301,632.481,1008.589,0.000,90.000,270.000,1},
    {19379,383.881,632.481,1008.589,0.000,90.000,270.000,1},
    {19369,388.612,628.821,1010.345,0.000,0.000,0.000,1},
    {19369,388.612,631.981,1010.345,0.000,0.000,0.000,1},
    {19369,388.612,635.181,1010.345,0.000,0.000,0.000,1},
    {19369,388.612,638.361,1010.345,0.000,0.000,0.000,1},
    {19369,387.002,637.640,1010.345,0.000,0.000,90.000,1},
    {19369,383.882,637.640,1010.345,0.000,0.000,90.000,1},
    {19369,380.752,637.640,1010.345,0.000,0.000,90.000,1},
    {19369,377.572,637.640,1010.345,0.000,0.000,90.000,1},
    {19369,374.382,637.640,1010.345,0.000,0.000,90.000,1},
    {19369,371.182,637.640,1010.345,0.000,0.000,90.000,1},
    {19369,383.932,627.260,1010.345,0.000,0.000,90.000,1},
    {19369,379.022,625.590,1010.345,0.000,0.000,180.000,1},
    {19369,371.192,627.260,1010.345,0.000,0.000,90.000,1},
    {19369,377.582,627.260,1010.345,0.000,0.000,90.000,1},
    {19369,380.742,627.260,1010.345,0.000,0.000,90.000,1},
    {19369,387.122,627.260,1010.345,0.000,0.000,90.000,1},
    {19369,379.022,622.380,1010.345,0.000,0.000,180.000,1},
    {19369,379.022,619.221,1010.345,0.000,0.000,180.000,1},
    {19369,377.442,617.580,1010.345,0.000,0.000,270.000,1},
    {19369,374.313,617.580,1010.345,0.000,0.000,270.000,1},
    {19369,371.203,617.580,1010.345,0.000,0.000,270.000,1},
    {19369,369.583,619.220,1010.345,0.000,0.000,360.000,1},
    {19369,369.583,622.370,1010.345,0.000,0.000,360.000,1},
    {19369,369.583,625.560,1010.345,0.000,0.000,360.000,1},
    {19369,369.583,628.730,1010.345,0.000,0.000,360.000,1},
    {19369,369.583,631.880,1010.345,0.000,0.000,360.000,1},
    {19369,369.583,635.010,1010.345,0.000,0.000,360.000,1},
    {19369,369.583,638.210,1010.345,0.000,0.000,360.000,1},
    {1506,388.525,633.680,1008.675,0.000,0.000,90.000,1},
    {19397,374.375,627.252,1010.345,0.000,0.000,90.000,1},
    {1491,375.131,627.269,1008.605,0.000,0.000,540.000,1},
    // Medium
    {19379,427.058,602.686,1002.676,540.000,990.000,450.000,2},
    {19379,427.058,613.025,1002.676,540.000,990.000,450.000,2},
    {19379,427.058,623.415,1002.676,540.000,990.000,450.000,2},
    {19379,417.508,623.415,1002.676,540.000,990.000,450.000,2},
    {19379,417.508,612.946,1002.676,540.000,990.000,450.000,2},
    {19379,417.508,602.546,1002.676,540.000,990.000,450.000,2},
    {19379,408.058,602.546,1002.676,540.000,990.000,450.000,2},
    {19379,408.058,613.016,1002.676,540.000,990.000,450.000,2},
    {19379,427.058,613.145,999.136,540.000,990.000,450.000,2},
    {19379,417.458,613.145,999.136,540.000,990.000,450.000,2},
    {19379,427.058,602.686,999.136,540.000,990.000,450.000,2},
    {19379,417.488,602.686,999.136,540.000,990.000,450.000,2},
    {19379,407.918,602.686,999.136,540.000,990.000,450.000,2},
    {19379,407.918,613.085,999.136,540.000,990.000,450.000,2},
    {19379,427.058,623.546,999.136,540.000,990.000,450.000,2},
    {19379,417.538,623.546,999.136,540.000,990.000,450.000,2},
    {19367,416.614,623.171,1000.873,0.000,-180.000,0.000,2},
    {19367,416.614,626.341,1000.873,0.000,-180.000,0.000,2},
    {19367,418.213,627.912,1000.873,0.000,-180.000,90.000,2},
    {19367,421.353,627.912,1000.873,0.000,-180.000,90.000,2},
    {19367,424.543,627.912,1000.873,0.000,-180.000,90.000,2},
    {19367,426.527,623.140,1000.878,180.000,0.000,180.000,2},
    {19367,426.527,626.320,1000.878,180.000,0.000,180.000,2},
    {19367,427.733,627.912,1000.873,0.000,-180.000,90.000,2},
    {19367,-922.011,597.801,-0.290,0.000,0.000,0.000,2},
    {19367,417.782,616.789,1000.873,0.000,-180.000,0.000,2},
    {19367,417.774,610.177,1000.873,0.000,-180.360,0.000,2},
    {19367,417.787,606.978,1000.873,0.000,-180.360,0.000,2},
    {19367,419.409,605.406,1000.878,-180.000,0.000,270.000,2},
    {19367,422.605,605.411,1000.878,-180.000,0.000,270.000,2},
    {19367,425.797,605.402,1000.878,-180.000,0.000,270.000,2},
    {19367,428.993,605.394,1000.878,-180.000,0.000,270.000,2},
    {19367,417.775,603.989,1000.893,0.000,-180.360,0.000,2},
    {19367,432.202,605.396,1000.878,-180.000,0.000,270.000,2},
    {19367,5829.613,-4209.926,-6659.902,0.000,0.000,0.000,2},
    {19367,5829.613,-4209.926,-6659.902,0.000,0.000,0.000,2},
    {19367,1683.819,-8018.711,-4805.494,0.000,0.000,0.000,2},
    {19367,433.064,0.663,1000.878,-180.000,0.000,270.000,2},
    {19367,431.692,607.110,1000.878,180.000,0.019,180.000,2},
    {19367,431.687,610.299,1000.878,180.000,0.000,180.000,2},
    {1505,8492.210,-2183.372,999.819,0.000,0.000,0.000,2},
    {1505,431.691,611.874,999.168,0.000,0.000,90.000,2},
    {19367,431.695,614.996,1000.878,180.000,0.000,180.000,2},
    {19367,431.699,618.190,1000.878,180.000,0.000,180.000,2},
    {19367,429.800,618.376,1000.878,180.000,0.000,90.000,2},
    {19367,426.595,618.386,1000.878,180.000,0.000,90.000,2},
    {19367,423.400,618.399,1000.878,180.000,0.000,90.000,2},
    {19367,426.527,619.989,1000.878,180.000,0.000,180.000,2},
    {19367,416.614,620.030,1000.873,0.000,-180.000,0.000,2},
    {19367,416.265,618.361,1000.878,180.000,0.000,90.000,2},
    {19367,418.747,618.353,1000.878,180.000,0.000,90.000,2},
    {19367,413.304,618.371,1000.878,180.000,0.000,90.000,2},
    {19367,410.369,618.390,1000.878,180.000,0.000,90.000,2},
    {19367,416.130,606.410,1000.878,180.000,0.000,90.000,2},
    {19367,413.114,606.416,1000.878,180.000,0.000,90.000,2},
    {19367,411.550,607.922,1000.873,0.000,-180.360,0.000,2},
    {19367,411.546,611.113,1000.873,0.000,-180.360,0.000,2},
    {19367,411.545,614.285,1000.873,0.000,-180.360,0.000,2},
    {19367,411.540,617.329,1000.873,0.000,-180.360,0.000,2},
    {19367,417.767,612.095,1000.873,0.000,-180.360,0.000,2},
    {1491,417.780,613.683,999.185,0.000,0.000,90.000,2},
    {1491,420.300,618.362,999.185,0.000,0.000,0.000,2},
    {19367,432.986,618.375,1000.878,180.000,0.000,90.000,2},
    {19367,420.929,618.403,1003.443,180.000,-180.000,-90.000,2},
    {19367,417.728,614.346,1003.417,178.000,180.000,360.000,2},
    {19367,431.165,612.774,1003.317,0.000,-18.360,359.799,2},
    // Big
    {970,1396.816894,1511.817016,14.148458,0.000000,0.000000,0.000000,3},
    {970,1392.625976,1511.817016,14.148458,0.000000,0.000000,0.000000,3},
    {970,1388.425415,1511.817016,14.148458,0.000000,0.000000,0.000000,3},
    {970,1384.225830,1511.817016,14.148458,0.000000,0.000000,0.000000,3},
    {19379,1388.848754,1513.377441,9.872499,0.000000,90.000000,0.000000,3},
    {19379,1388.848754,1523.007690,9.872499,0.000000,90.000000,0.000000,3},
    {19379,1399.318115,1513.377441,9.872499,0.000000,90.000000,0.000000,3},
    {19379,1399.318115,1522.998779,9.872499,0.000000,90.000000,0.000000,3},
    {19449,1383.703491,1513.386108,11.678435,0.000000,0.000000,0.000000,3},
    {19449,1383.703491,1523.005493,11.678435,0.000000,0.000000,0.000000,3},
    {19449,1388.542968,1527.735717,11.678435,0.000000,0.000000,90.000000,3},
    {19449,1398.162963,1527.735717,11.678435,0.000000,0.000000,90.000000,3},
    {19379,1409.817871,1522.998779,9.872499,0.000000,90.000000,0.000000,3},
    {19449,1407.782470,1527.735717,11.678435,0.000000,0.000000,90.000000,3},
    {19379,1409.817749,1513.377441,16.992519,0.000000,90.000000,0.000000,3},
    {19357,1414.204345,1527.735717,11.678435,0.000000,0.000000,90.000000,3},
    {19449,1414.966674,1523.005493,11.678435,0.000000,0.000000,0.000000,3},
    {19449,1414.966674,1513.383422,11.678435,0.000000,0.000000,0.000000,3},
    {19449,1407.782470,1508.654907,11.678435,0.000000,0.000000,90.000000,3},
    {19357,1414.204345,1508.654541,11.678435,0.000000,0.000000,90.000000,3},
    {19449,1398.151000,1508.654907,11.678435,0.000000,0.000000,90.000000,3},
    {19449,1388.539184,1508.654907,11.678435,0.000000,0.000000,90.000000,3},
    {19379,1409.817871,1522.998779,13.512515,0.000000,90.000000,0.000000,3},
    {19379,1399.356567,1522.998779,13.512515,0.000000,90.000000,0.000000,3},
    {19357,1394.183959,1526.056274,11.678435,0.000000,0.000000,0.000000,3},
    {19387,1394.183959,1522.856079,11.678435,0.000000,0.000000,0.000000,3},
    {19449,1394.183959,1516.596801,11.678435,0.000000,0.000000,0.000000,3},
    {1502,1394.128906,1523.636474,9.938437,0.000000,0.000000,-90.000000,3},
    {19357,1399.072998,1518.105712,11.678435,0.000000,0.000000,90.000000,3},
    {19379,1404.155883,1513.388671,13.512515,0.000000,90.000000,0.000000,3},
    {19449,1408.535888,1518.105712,11.678435,0.000000,0.000000,90.000000,3},
    {14414,1397.078125,1509.768432,10.228441,0.000000,0.000000,90.000000,3},
    {19387,1402.253906,1518.116088,11.678435,0.000000,0.000000,90.000000,3},
    {19357,1395.872192,1518.105712,11.678435,0.000000,0.000000,90.000000,3},
    {19387,1402.253906,1510.323974,11.678435,0.000000,0.000000,180.000000,3},
    {19370,1397.156250,1516.577636,13.512515,0.000000,90.000000,0.000000,3},
    {19462,1411.136108,1513.377807,13.512515,0.000000,90.000000,0.000000,3},
    {19462,1414.627563,1513.377807,13.512515,0.000000,90.000000,0.000000,3},
    {19430,1414.133544,1518.105712,11.678435,0.000000,0.000000,-90.000000,3},
    {19357,1400.563964,1511.834960,11.678435,0.000000,0.000000,90.000000,3},
    {19357,1397.354003,1511.885009,11.678435,0.000000,0.000000,90.000000,3},
    {19430,1395.042846,1511.885131,11.678435,0.000000,0.000000,-90.000000,3},
    {19370,1397.156250,1513.406616,13.512515,0.000000,90.000000,0.000000,3},
    {19449,1414.966674,1523.005493,15.168431,0.000000,0.000000,0.000000,3},
    {19449,1414.966674,1513.383422,15.168424,0.000000,0.000000,0.000000,3},
    {19379,1388.866943,1522.998779,13.512515,0.000000,90.000000,0.000000,3},
    {19462,1390.591674,1513.552001,13.512515,0.000000,90.000000,270.000000,3},
    {19462,1390.591674,1517.032836,13.512515,0.000000,90.000000,270.000000,3},
    {19370,1384.045410,1513.406616,13.512515,0.000000,90.000000,0.000000,3},
    {19449,1383.703491,1523.005493,15.168426,0.000000,0.000000,0.000000,3},
    {19449,1383.703491,1513.375122,15.168426,0.000000,0.000000,0.000000,3},
    {19449,1407.782470,1508.654907,15.158441,0.000000,0.000000,90.000000,3},
    {19357,1414.204345,1508.654541,15.158438,0.000000,0.000000,90.000000,3},
    {19449,1398.182006,1508.654907,15.158441,0.000000,0.000000,90.000000,3},
    {19449,1388.591796,1508.654907,15.158441,0.000000,0.000000,90.000000,3},
    {19449,1388.542968,1527.735717,15.168425,0.000000,0.000000,90.000000,3},
    {19449,1398.162231,1527.735717,15.168425,0.000000,0.000000,90.000000,3},
    {19449,1407.793579,1527.735717,15.168425,0.000000,0.000000,90.000000,3},
    {19357,1414.204345,1527.735717,15.168425,0.000000,0.000000,90.000000,3},
    {19379,1388.848754,1513.377441,16.992519,0.000000,90.000000,0.000000,3},
    {19379,1388.848754,1523.007690,16.992519,0.000000,90.000000,0.000000,3},
    {19379,1399.318115,1522.998779,16.992519,0.000000,90.000000,0.000000,3},
    {19379,1399.318115,1513.377441,16.992519,0.000000,90.000000,0.000000,3},
    {19379,1409.817871,1522.998779,16.992519,0.000000,90.000000,0.000000,3},
    {19379,1409.817749,1513.377441,9.872499,0.000000,90.000000,0.000000,3},
    {1502,1403.000488,1518.127197,9.938437,0.000000,0.000000,-180.000000,3},
    {1502,1402.281005,1509.533569,9.938437,0.000000,0.000000,-270.000000,3},
    {19370,1384.044799,1516.577636,13.512515,0.000000,90.000000,0.000000,3},
    {19357,1385.401733,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19387,1388.611816,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19357,1391.822875,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19387,1395.031616,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19357,1401.432861,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19357,1398.232177,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19387,1404.621215,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19357,1407.833740,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19357,1411.033813,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19387,1414.241210,1518.273803,15.178421,0.000000,0.000000,90.000000,3},
    {19449,1393.243164,1523.046752,15.178421,0.000000,0.000000,0.000000,3},
    {19449,1402.263916,1523.046752,15.178421,0.000000,0.000000,0.000000,3},
    {19449,1411.655273,1523.046752,15.178421,0.000000,0.000000,0.000000,3},
    {1502,1389.360107,1518.306274,13.418445,0.000000,0.000000,-180.000000,3},
    {1502,1395.781005,1518.306274,13.418445,0.000000,0.000000,-180.000000,3},
    {1502,1405.360839,1518.306274,13.418445,0.000000,0.000000,-180.000000,3},
    {1502,1414.991333,1518.306274,13.418445,0.000000,0.000000,-180.000000,3},
    {1504,1383.777343,1518.188476,9.948436,0.000000,0.000000,90.000000,3},
    {1504,1383.777343,1518.219482,9.948436,0.000000,0.000000,270.000000,3}
};

//============================================

/*Dialogs*/

#define DIALOG_EDIT_HOUSE_1 1000
#define	DIALOG_EDIT_HOUSE_2 1001
#define	DIALOG_EDIT_EXTERIOR 1002
#define	DIALOG_EDIT_INTERIOR 1006
#define	DIALOG_EDIT_DESC 1011
#define	DIALOG_EDIT_OWNER 1012
#define DIALOG_EDIT_PRICE 1013
#define DIALOG_HOUSE_ACCEPT 1014
#define DIALOG_HOUSE_LEAVE 1015